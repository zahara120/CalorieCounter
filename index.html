<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="datauser.css">
    <link rel="stylesheet" href="setgoals.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <title>Calorie Counter</title>
</head>

<body>
    <section id="home">
        <div class="box-desc">
            <h1 class="title">CalorieCounter</h1>
            <p class="desc">
                CalorieCounter adalah situs web sederhana dan efektif yang membantu Anda memantau asupan kalori harian
                Anda sesuai dengan tujuan kesehatan Anda, apakah itu menurunkan berat badan, menambah berat badan, atau
                mempertahankan berat badan.
            </p>
            <button class="primary-btn" style="margin-top: 10px;" onclick="changepage('userData')">Lanjut</button>
        </div>
        <img src="assets/img/people-and-technology.png" alt="image 1">
    </section>
    <section class="form-container" id="userData">
        <img src="assets/img/img-1.png" alt="Image 1" class="form-image">
        <form id="dataForm">
            <div class="fields-container">
                <div class="field-box">
                    <div class="form-field">
                        <label for="username">Nama</label>
                        <input type="text" name="nama" id="username">
                    </div>
                    <div class="form-field">
                        <label for="userage">Umur</label>
                        <input type="number" name="umur" id="userage">
                    </div>
                </div>
                <div class="field-box">
                    <div class="form-field">
                        <label for="userheight">Tinggi (cm)</label>
                        <input type="number" name="tinggi" id="userheight">
                    </div>
                    <div class="form-field">
                        <label for="userweight">Berat (kg)</label>
                        <input type="number" name="berat" id="userweight">
                    </div>
                </div>
                <div class="field-box">
                    <div class="form-field">
                        <label for="usergender">Jenis Kelamin</label>
                        <select name="gender" id="usergender">
                            <option value="male">Laki-laki</option>
                            <option value="female">Perempuan</option>
                        </select>
                    </div>
                </div>
                <div class="field-box">
                    <div class="form-field">
                        <label for="useractivity">Tingkat Aktivitas</label>
                        <select name="activity" id="useractivity">
                            <option value="sedentary">Sangat sedikit atau tidak ada olahraga</option>
                            <option value="light">Olahraga ringan (1-3 hari/minggu)</option>
                            <option value="moderate">Olahraga moderat (3-5 hari/minggu)</option>
                            <option value="active">Olahraga berat (6-7 hari/minggu)</option>
                            <option value="very_active">Olahraga sangat berat</option>
                        </select>
                    </div>
                </div>
                <button class="primary-btn" style="margin-top: 10px;" onclick="greetings()">Lanjut</button>
            </div>
        </form>
    </section>
    <section id="goals">
        <!-- <h1>Set Goals</h1>
        <span id="bmrResult"></span>
        <button class="primary-btn" style="width: 40%;" onclick="changepage('meals')">Lanjut</button> -->
        <div class="container container-setGoals">
            <div class="title">
                <h1>Apa tujuanmu?</h1>
            </div>
            <div class="selection-items">
                <button class="container-item container-menurunkan" onclick="getGoals('lose')">
                    <img src="./assets/img/fruit.png" alt="img-fruit">
                    <span class="item-text">Menurunkan Berat Badan</span>
                </button>
                <button class="container-item container-menjaga" onclick="getGoals('maintenance')">
                    <img src="./assets/img/menjaga.png" alt="img-menjaga">
                    <span class="item-text">Menjaga Berat Badan</span>
                </button>
                <button class="container-item container-menaikan" onclick="getGoals('gain')">
                    <img src="./assets/img/foods.png" alt="img-foods">
                    <span class="item-text">Menaikan Berat Badan</span>
                </button>
            </div>
        </div>
    </section>
    <section id="meals">
        <!-- <h1>Meals</h1>
        <button class="primary-btn" style="width: 40%;" onclick="changepage('result')">Lanjut</button> -->
        <div class="container container-makanApa">
            <h1>Makan apa hari ini?</h1>
            <div class="table-meals">
                <table class="table table-striped table-hover table-bordered border-dark">
                    <thead>
                        <tr>
                            <td style="width: 5%;">No.</td>
                            <td>Makananmu</td>
                            <td style="width: 10%;">Kalori</td>
                            <td style="width: 10%;">Jumlah</td>
                            <td style="width: 20%;"></td>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
            <div class="container-meals-bawah">
                <div class="container-kalori">
                    <div class="calori-number">
                        <h4>Kalorimu</h4>
                        <h3 id="calCount">0</h3>
                    </div>
                    <div style="width: 70%;" class="meal-entry">
                        <!-- <label for="meal">Pilih Makananmu</label> -->
                        <select name="makanan" id="meal" placeholder="pilih makananmu">

                        </select>
                        <button class="button-masukan-meal btn btn-outline-success" onclick="addMeal()">Masukan</button>
                    </div>
                </div>
                <button class="primary-btn mt-4" onclick="changepage('result')">Lanjut</button>
            </div>
        </div>
    </section>
    <section class="form-containers" id="result">
        <h1>Result</h1>
        <button class="primary-btn" style="width: 40%;" onclick="changepage('home')">Kembali</button>
    </section>
</body>

<script>
    let user = {
        'nama': '',
        'umur': '',
        'tinggi': '',
        'berat': '',
        'kelamin': '',
        'activity': '',
        'kalori makanan': 0
    };
    // list makanan
    let foods = [
        { nama: 'nasi putih', kalori: 150 },
        { nama: 'ayam goreng', kalori: 250 },
        { nama: 'sayur bayam', kalori: 50 },
        { nama: 'pisang', kalori: 100 },
        { nama: 'roti tawar', kalori: 80 },
        { nama: 'telur rebus', kalori: 70 },
        { nama: 'ikan salmon panggang', kalori: 200 },
        { nama: 'kacang almond', kalori: 160 },
        { nama: 'susu rendah lemak', kalori: 90 },
        { nama: 'yogurt plain', kalori: 120 },
        { nama: 'apel', kalori: 50 },
        { nama: 'wortel', kalori: 30 },
        { nama: 'brokoli', kalori: 40 },
        { nama: 'sereal gandum utuh', kalori: 120 },
        { nama: 'roti gandum', kalori: 100 }
    ];

    function changepage(to) {
        document.getElementById(to).scrollIntoView({ behavior: 'smooth' });

        console.log(user);
    }

    // calculate BMR nya, untuk tau jumlah kalori yang dibakar tubuh saat istirahat
    function calculateBmr(data) {
        let result = 0;
        if (data.kelamin === 'male') {
            result = 10 * +data.berat + 6.25 * +data.tinggi - 5 * +data.umur + 5;
        } else if (data.kelamin === 'female') {
            result = 10 * +data.berat + 6.25 * +data.tinggi - 5 * +data.umur - 161;
        }
        return result;
    }

    // calculate TDEE nya, untuk tau jumlah kalori yang dibutuhkan tubuh dalam sehari
    function calculateTdee(bmr, data) {
        let activityFactor = {
            'sedentary': 1.2,
            'light': 1.375,
            'moderate': 1.55,
            'active': 1.725,
            'very_active': 1.9
        }

        return bmr * activityFactor[data.activity];
    }

    // ambil goals
    function getGoals(value) {
        // panggil adjustTdeeForGoal
        let adjustTdee = adjustTdeeForGoal(user['TDEE'], value)
        user['TDEE'] = adjustTdee

        changepage('meals')
        console.log('setelah di adjust', user);

        return value
    }

    // adjust TDEE nya sesuai goals user, kalo dia mau lose weight tdee/kalori harus di kurang, dan sebalik nya
    function adjustTdeeForGoal(tdee, goals) {
        if (goals === 'gain') {
            // kalo mau gain, biasanya naikin 250-500 kalori/hari
            return tdee + 500
        }
        else if (goals === 'lose') {
            // kalo mau lose, biasanya cut 500-1000 kalori/hari
            return tdee - 500
        }
        else {
            return tdee
        }
    }

    // itung kalori dari makanan yang user input, buat di compare sama tdee(kalori harian) user
    function calculteCaloriesInFood(foods) {

    }

    function greetings() {
        event.preventDefault();
        const form = document.getElementById('dataForm');

        // Ambil value
        const nama = form.querySelector('#username').value;
        const umur = form.querySelector('#userage').value;
        const tinggi = form.querySelector('#userheight').value;
        const berat = form.querySelector('#userweight').value;
        const kelamin = form.querySelector('#usergender').value;
        const activity = form.querySelector('#useractivity').value;

        if (nama === '' || umur === '' || tinggi === '' || berat === '' || kelamin === '' || activity === '') {
            alert('Harap lengkapi semua kolom sebelum melanjutkan!');
            return;
        }

        // assign value
        user.nama = nama
        user.umur = umur
        user.tinggi = tinggi
        user.berat = berat
        user.kelamin = kelamin
        user.activity = activity

        // calculate BMR nya, untuk tau jumlah kalori yang dibakar tubuh saat istirahat
        let bmr = calculateBmr(user);

        // calculate TDEE nya, untuk tau jumlah kalori yang dibutuhkan tubuh dalam sehari
        let tdee = calculateTdee(bmr, user);

        // tambahin data user
        user['BMR'] = bmr
        user['TDEE'] = tdee

        // Menampilkan hasil BMR di halaman
        // document.getElementById('bmrResult').innerText = `Tubuh Anda membakar ${bmr} kalori saat istirahat, TDEE anda ${tdee}`;

        console.log('sebelum di adjust', user);

        // pindah section ke goals
        changepage('goals');
    }

    // Bagian table
    let numberCounter = 0;
    let tableValue = [];
    let calorieCounted = 0;

    function calorieCount() {
        calorieCounted = 0;
        for (let i = 0; i < tableValue.length; i++) {
            let number = tableValue[i].kalori * tableValue[i].jumlah
            calorieCounted += number;
        }

        user['kalori makanan'] = calorieCounted
    }

    function buttonAction(type, index, id) {
        for (let i = 0; i < tableValue.length; i++) {
            if (index === tableValue[i].nama) {
                if (type === '+') {
                    tableValue[i].jumlah += 1;
                    tableValue[i].totalCal += tableValue[i].kalori;
                    document.getElementById(`colCal-${index}`).innerText = tableValue[i].totalCal;
                    document.getElementById(`colQty-${index}`).innerText = tableValue[i].jumlah;
                } else if (type === '-') {
                    if (tableValue[i].jumlah > 1) {
                        tableValue[i].jumlah -= 1;
                        tableValue[i].totalCal -= tableValue[i].kalori;
                        document.getElementById(`colCal-${index}`).innerText = tableValue[i].totalCal;
                        document.getElementById(`colQty-${index}`).innerText = tableValue[i].jumlah;
                    }
                } else if (type === 'hapus') {
                    for (let j = 0; j < tableValue.length; j++) {
                        if (tableValue[j].id === id) {
                            foods.push({ nama: tableValue[j].nama, kalori: tableValue[j].kalori })
                            tableValue.splice(j, 1)
                            break;
                        }
                    }

                    let tableContent = '';
                    numberCounter = 0;
                    document.getElementById('tableBody').innerHTML = '';

                    for (let i = 0; i < tableValue.length; i++) {
                        numberCounter++;
                        tableValue[i].id = numberCounter;
                        tableContent += `
                                        <tr>
                                            <td>${numberCounter}</td>
                                            <td>${tableValue[i].nama}</td>
                                            <td id="colCal-${tableValue[i].nama}">${tableValue[i].totalCal}</td>
                                            <td id="colQty-${tableValue[i].nama}">${tableValue[i].jumlah}</td>
                                            <td>
                                                <button type="button" class="btn btn-outline-success" onclick="buttonAction('+', '${tableValue[i].nama}')">+</button>
                                                <button type="button" class="btn btn-outline-primary" onclick="buttonAction('-', '${tableValue[i].nama}')">-</button>
                                                <button type="button" class="btn btn-outline-danger" onclick="buttonAction('hapus', '${tableValue[i].nama}', ${tableValue[i].id})">Hapus</button>
                                            </td>
                                        </tr>
                                        `
                    }

                    document.getElementById('tableBody').innerHTML = tableContent;
                    console.log(tableContent);
                    updateFoodsMaterials();

                }
            }
        }
        calorieCount()
        document.getElementById('calCount').innerText = calorieCounted;
        user['kalori makanan'] = calorieCounted
    }

    // Bagian calorie counter dan tambah makanan
    let selectOption = document.getElementById('meal').innerHTML;

    for (let i = 0; i < foods.length; i++) {
        selectOption += `<option value="${foods[i].nama}">${foods[i].nama}</option>`
    }

    document.getElementById('meal').innerHTML = selectOption;

    function updateFoodsMaterials() {
        selectOption = '';

        for (let i = 0; i < foods.length; i++) {
            selectOption += `<option value="${foods[i].nama}">${foods[i].nama}</option>`
        }

        document.getElementById('meal').innerHTML = selectOption;
    }

    function addMeal() {
        let selected = document.getElementById('meal').value;
        for (let i = 0; i < foods.length; i++) {
            if (selected === foods[i].nama) {
                foods[i]['id'] = numberCounter;
                foods[i]['jumlah'] = 1;
                foods[i]['totalCal'] = foods[i].kalori;
                tableValue.push(foods[i]);
                document.getElementById('tableBody').innerHTML +=
                    `
                    <tr>
                        <td>${numberCounter += 1}</td>
                        <td>${foods[i].nama}</td>
                        <td id="colCal-${foods[i].nama}">${foods[i].totalCal}</td>
                        <td id="colQty-${foods[i].nama}">${1}</td>
                        <td>
                            <button type="button" class="btn btn-outline-success" onclick="buttonAction('+', '${foods[i].nama}')">+</button>
                            <button type="button" class="btn btn-outline-primary" onclick="buttonAction('-', '${foods[i].nama}')">-</button>
                            <button type="button" class="btn btn-outline-danger" onclick="buttonAction('hapus', '${foods[i].nama}', ${foods[i].id})">Hapus</button>
                        </td>
                    </tr>
                `;

                calorieCount();
                document.getElementById('calCount').innerText = calorieCounted;
                user['kalori makanan'] = calorieCounted

                foods.splice(i, 1)
                updateFoodsMaterials();
            }
        }
    }
</script>

</html>